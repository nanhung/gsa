---
title: "ViSA_NB"
output:
  html_document:
    df_print: paged
  html_notebook: default
---


```{r message = FALSE, warning=FALSE}
# Install the ViSA
devtools::install_github("nanhung/ViSA")
```

# Import the packages

```{r message = FALSE, warning=FALSE}
library(ViSA) # Visualization of sensitivity analysis
library(sensitivity) # Sensitivity analysis for model output
library(tidyverse) # Data science toolkits
```

# Use the add-in function (sobol) and do the testing

```{r message = FALSE}
n <- 1000
set.seed(1234)
X1 <- data.frame(matrix(runif(8 * n), nrow = n))
X2 <- data.frame(matrix(runif(8 * n), nrow = n))
x <- soboljansen(model = NULL, X1, X2, nboot = 100)
y <- sobol.fun(x$X)
tell(x,y)
x
```

# Plot the result of sensitivity analysis

```{r message = FALSE}
# 
tell(x,y) %>% plot
```

# Check the coverge
Use the `converge` function (built in ViSA package)

```{r message = FALSE}
# 
tell(x,y) %>% converge
```

# Visualization of converge result

Use the `plot.converge` function (built in ViSA package)

```{r message = FALSE}
tell(x,y) %>% converge %>% plot.converge
```

# Customize the parameter label

```{r message = FALSE}
parameters<-c("k01","k12", "k23", "k34", "k45","k56", "k67", "k78")
tell(x,y) %>% converge(parameters) %>% plot.converge
```

# 
Use `convergejansen` to make the serious output
! This method might take long time for the complex computing

```{r message = FALSE}
set.seed(1234)
convergejansen(n = 8000, n.factors = 8, X = sobol.X, fun = sobol.fun) # The defaut output is total effect
```

# Plot 

```{r message = FALSE}
set.seed(1234)
convergejansen(n = 1000, n.factors = 8, X = sobol.X, fun = sobol.fun) %>% 
  converge.plot
```

Use `order = "S"` to check the main effect

```{r message = FALSE}
set.seed(1234)
convergejansen(n = 1000, n.factors = 8, X = sobol.X, fun = sobol.fun, order = "S") %>% 
  converge.plot
```

# Customize the parameter number and distribution
Increase the number of parameter to 10 as example
```{r message = FALSE}
#
test.X<- function(n){
  data.frame(k01 = runif(n, 0, 1),
             k12 = runif(n, 0, 1),
             k23 = runif(n, 0, 1),
             k34 = runif(n, 0, 1),
             k45 = runif(n, 0, 1),
             k56 = runif(n, 0, 1),
             k67 = runif(n, 0, 1),
             k78 = runif(n, 0, 1),
             k89 = runif(n, 0, 1),
             k90 = runif(n, 0, 1))
}
```

# RUN

```{r message = FALSE}
set.seed(1234)
convergejansen(n = 8000, n.factors = 10, X = test.X, fun = sobol.fun, order = "S") %>% 
  converge.plot

set.seed(1234)
convergejansen(n = 8000, n.factors = 10, X = test.X, fun = sobol.fun) %>% 
  converge.plot
```


