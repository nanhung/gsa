---
title: "ViSA_NB"
output:
  html_document:
    df_print: paged
  html_notebook: default
---


```{r message = FALSE, warning=FALSE}
# Install the ViSA
devtools::install_github("nanhung/ViSA")
```

# Import the packages

```{r message = FALSE, warning=FALSE}
library(ViSA) # Visualization of sensitivity analysis
library(sensitivity) # Sensitivity analysis for model output
library(tidyverse) # Data science toolkits
```

# Use the add-in function (sobol) and do the testing

```{r message = FALSE}
n <- 1000
set.seed(1234)
X1 <- data.frame(matrix(runif(8 * n), nrow = n))
X2 <- data.frame(matrix(runif(8 * n), nrow = n))
x <- soboljansen(model = NULL, X1, X2, nboot = 100)
y <- sobol.fun(x$X)
tell(x,y)
x
```

# Plot the result of sensitivity analysis

```{r message = FALSE}
tell(x,y) %>% plot
abline(0.01, 0 ,lty=2) # add threshold
```

# Check and plot the coverge
Use the `converge` function (built in ViSA package)

```{r message = FALSE}
# 
tell(x,y) %>% converge
```


# Convergence plot - trace output
Use `convergejansen` to make the serious output
! This method might take long time for the complex computing

```{r message = FALSE}
set.seed(1234)
convergejansen(n = 1000, n.factors = 8, X = sobol.X, fun = sobol.fun) # Output the data frame of sensitivity index (main: S_si, total: T_si) convergence index (main: S_ci, total: T_ci) 
```

## Plot result - convergence index of total effect

```{r message = FALSE}
set.seed(1234)
convergejansen(n = 1000, n.factors = 8, X = sobol.X, fun = sobol.fun) %>% 
  converge.plot # The default output is convergence index of total effect
```

## Convergence index of main effect

```{r message = FALSE}
convergejansen(n = 1000, n.factors = 8, X = sobol.X, fun = sobol.fun) %>% 
  converge.plot(index = "M-ci")
```

## Sensitivity index of total effect
Use `converge.plot(index = "T-si")` 

```{r message = FALSE}
set.seed(1234)
convergejansen(n = 1000, n.factors = 8, X = sobol.X, fun = sobol.fun) %>% 
  converge.plot(index = "T-si")
```

## Sensitivity index of Main effect
Use `converge.plot(index = "M-si")` 

```{r message = FALSE}
set.seed(1234)
convergejansen(n = 1000, n.factors = 8, X = sobol.X, fun = sobol.fun) %>% 
  converge.plot(index = "M-si")
```

# Customize the parameter number and distribution
Increase the number of parameter to 10 as example
```{r message = FALSE}
#
test.X<- function(n){
  data.frame(k01 = runif(n, 0, 1),
             k12 = runif(n, 0, 1),
             k23 = runif(n, 0, 1),
             k34 = runif(n, 0, 1),
             k45 = runif(n, 0, 1),
             k56 = runif(n, 0, 1),
             k67 = runif(n, 0, 1),
             k78 = runif(n, 0, 1),
             k89 = runif(n, 0, 1),
             k90 = runif(n, 0, 1))
}
```

# RUN

```{r message = FALSE}
set.seed(1234)
convergejansen(n = 4000, n.factors = 10, X = test.X, fun = sobol.fun) %>% 
  converge.plot

set.seed(1234)
convergejansen(n = 4000, n.factors = 10, X = test.X, fun = sobol.fun) %>% 
  converge.plot("M-ci")

set.seed(1234)
convergejansen(n = 4000, n.factors = 10, X = test.X, fun = sobol.fun) %>% 
  converge.plot("T-si")

set.seed(1234)
convergejansen(n = 4000, n.factors = 10, X = test.X, fun = sobol.fun) %>% 
  converge.plot("M-si")

```


